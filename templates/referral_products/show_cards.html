<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Доступные заказы - ReFlow</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base_styles.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Стили остаются такими же как в предыдущем варианте */
        .orders-container { max-width: 500px; margin: 0 auto; padding: 1rem; min-height: 100vh; }
        .orders-header { text-align: center; margin-bottom: 2rem; padding: 1rem 0; }
        .orders-title { font-size: 2rem; margin-bottom: 0.5rem; color: var(--platinum-text); }
        .orders-subtitle { color: var(--color-text-secondary); margin-bottom: 1rem; }
        .order-card-container { position: relative; height: 600px; margin-bottom: 2rem; }
        .order-card { position: absolute; width: 100%; height: 100%; background: linear-gradient(145deg, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.08) 50%, rgba(255, 255, 255, 0.12) 100%); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: var(--radius-xl); padding: 1.5rem; box-shadow: 0 25px 50px rgba(0, 0, 0, 0.7); transition: all 0.3s ease; display: flex; flex-direction: column; }
        .order-image { width: 100%; height: 250px; object-fit: cover; border-radius: var(--radius-lg); margin-bottom: 1rem; }
        .order-title { font-size: 1.4rem; font-weight: 600; color: var(--platinum-text); margin-bottom: 0.5rem; }
        .order-description { color: var(--color-text-secondary); margin-bottom: 1rem; line-height: 1.5; flex-grow: 1; }
        .order-details { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem; }
        .order-detail { display: flex; flex-direction: column; gap: 0.3rem; }
        .detail-label { font-size: 0.8rem; color: var(--color-text-muted); }
        .detail-value { font-weight: 600; color: var(--platinum-text); }
        .status-badge { padding: 0.5rem 1rem; border-radius: var(--radius-md); font-size: 0.9rem; font-weight: 500; text-align: center; margin-bottom: 1rem; }
        .status-new { background-color: rgba(59, 130, 246, 0.3); color: #3b82f6; border: 1px solid rgba(59, 130, 246, 0.5); }
        .action-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: auto; }
        .action-btn { padding: 1rem; border: none; border-radius: var(--radius-lg); font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 0.5rem; }
        .accept-btn { background: linear-gradient(135deg, #10b981, #059669); color: white; }
        .accept-btn:hover { background: linear-gradient(135deg, #059669, #047857); transform: translateY(-2px); box-shadow: 0 5px 15px rgba(16, 185, 129, 0.4); }
        .reject-btn { background: linear-gradient(135deg, #ef4444, #dc2626); color: white; }
        .reject-btn:hover { background: linear-gradient(135deg, #dc2626, #b91c1c); transform: translateY(-2px); box-shadow: 0 5px 15px rgba(239, 68, 68, 0.4); }
        .no-orders { text-align: center; padding: 3rem; color: var(--color-text-secondary); }
        .swipe-hint { text-align: center; color: var(--color-text-muted); font-size: 0.9rem; margin-top: 1rem; }
        .stats-bar { display: flex; justify-content: space-around; margin-bottom: 1rem; padding: 1rem; background: var(--form-bg); border-radius: var(--radius-lg); border: 1px solid var(--form-border); }
        .stat-item { text-align: center; }
        .stat-number { font-size: 1.5rem; font-weight: 700; color: var(--primary-blue); }
        .stat-label { font-size: 0.8rem; color: var(--color-text-muted); }
        @media (max-width: 768px) { .orders-container { padding: 0.5rem; } .order-card-container { height: 550px; } .order-image { height: 200px; } .action-btn { padding: 0.8rem; font-size: 1rem; } }
    </style>
</head>
<body>
    <div class="orders-container">
        <div class="orders-header">
            <h1 class="orders-title">Доступные заказы</h1>
            <p class="orders-subtitle">Выбирайте заказы и увеличивайте свой доход</p>
        </div>

        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-number" id="totalOrders">{{ orders|length }}</div>
                <div class="stat-label">Всего</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="availableOrders">{{ orders|length }}</div>
                <div class="stat-label">Доступно</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="totalEarnings">0 ₽</div>
                <div class="stat-label">Заработок</div>
            </div>
        </div>

        <div class="order-card-container" id="orderCardContainer">
            {% if orders %}
                <div class="order-card">
                    <img src="{{ orders[0].image }}" alt="{{ orders[0].title }}" class="order-image">
                    <span class="status-badge status-new">Новый заказ</span>

                    <h3 class="order-title">{{ orders[0].title }}</h3>
                    <p class="order-description">{{ orders[0].description }}</p>

                    <div class="order-details">
                        <div class="order-detail">
                            <span class="detail-label">Сумма заказа</span>
                            <span class="detail-value">{{ orders[0].price|int|format_currency }} ₽</span>
                        </div>
                        <div class="order-detail">
                            <span class="detail-label">Ваша комиссия</span>
                            <span class="detail-value">{{ orders[0].commission|int|format_currency }} ₽</span>
                        </div>
                        <div class="order-detail">
                            <span class="detail-label">Клиентов</span>
                            <span class="detail-value">{{ orders[0].quantity }} шт</span>
                        </div>
                        <div class="order-detail">
                            <span class="detail-label">Дата</span>
                            <span class="detail-value">{{ orders[0].date }}</span>
                        </div>
                    </div>
                </div>
            {% else %}
                <div class="no-orders">
                    <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                    <h3>Заказов пока нет</h3>
                    <p>Новые заказы появятся здесь скоро</p>
                </div>
            {% endif %}
        </div>

        {% if orders %}
        <div class="action-buttons" id="actionButtons">
            <button class="action-btn reject-btn" onclick="rejectOrder()">
                <i class="fas fa-times"></i> Не беру
            </button>
            <button class="action-btn accept-btn" onclick="acceptOrder()">
                <i class="fas fa-check"></i> Беру!
            </button>
        </div>
        {% endif %}

        <div class="swipe-hint">
            <i class="fas fa-arrows-alt-h"></i> Листайте заказы свайпом влево/вправо
        </div>
    </div>

    <script>
        // Данные передаются из Flask
        const ordersData = {{ orders|tojson }};
        let currentOrderIndex = 0;
        let totalEarnings = 0;
        let acceptedOrders = 0;

        function showCurrentOrder() {
            const container = document.getElementById('orderCardContainer');
            const actionButtons = document.getElementById('actionButtons');

            if (currentOrderIndex >= ordersData.length) {
                container.innerHTML = `
                    <div class="no-orders">
                        <i class="fas fa-check-circle" style="font-size: 3rem; margin-bottom: 1rem; color: #10b981;"></i>
                        <h3>Все заказы просмотрены</h3>
                        <p>Вы приняли ${acceptedOrders} заказов</p>
                    </div>
                `;
                actionButtons.style.display = 'none';
                return;
            }

            const order = ordersData[currentOrderIndex];

            container.innerHTML = `
                <div class="order-card">
                    <img src="${order.image}" alt="${order.title}" class="order-image">
                    <span class="status-badge status-new">Новый заказ</span>

                    <h3 class="order-title">${order.title}</h3>
                    <p class="order-description">${order.description}</p>

                    <div class="order-details">
                        <div class="order-detail">
                            <span class="detail-label">Сумма заказа</span>
                            <span class="detail-value">${new Intl.NumberFormat('ru-RU').format(order.price)} ₽</span>
                        </div>
                        <div class="order-detail">
                            <span class="detail-label">Ваша комиссия</span>
                            <span class="detail-value">${new Intl.NumberFormat('ru-RU').format(order.commission)} ₽</span>
                        </div>
                        <div class="order-detail">
                            <span class="detail-label">Клиентов</span>
                            <span class="detail-value">${order.quantity} шт</span>
                        </div>
                        <div class="order-detail">
                            <span class="detail-label">Дата</span>
                            <span class="detail-value">${order.date}</span>
                        </div>
                    </div>
                </div>
            `;

            updateStats();
        }

        function acceptOrder() {
            if (currentOrderIndex >= ordersData.length) return;

            const order = ordersData[currentOrderIndex];
            totalEarnings += order.commission;
            acceptedOrders++;

            // Отправка на сервер (можно добавить fetch запрос)
            console.log('Принят заказ:', order.id);

            currentOrderIndex++;
            showCurrentOrder();
        }

        function rejectOrder() {
            if (currentOrderIndex >= ordersData.length) return;

            const order = ordersData[currentOrderIndex];
            console.log('Отклонен заказ:', order.id);

            currentOrderIndex++;
            showCurrentOrder();
        }

        function updateStats() {
            document.getElementById('availableOrders').textContent = ordersData.length - currentOrderIndex;
            document.getElementById('totalEarnings').textContent = new Intl.NumberFormat('ru-RU').format(Math.round(totalEarnings)) + ' ₽';
        }

        // Свайп-навигация
        function setupSwipe() {
            const container = document.getElementById('orderCardContainer');
            let startX = 0;
            let currentX = 0;

            container.addEventListener('touchstart', (e) => {
                startX = e.touches[0].clientX;
            });

            container.addEventListener('touchmove', (e) => {
                currentX = e.touches[0].clientX;
            });

            container.addEventListener('touchend', () => {
                const diff = currentX - startX;
                if (Math.abs(diff) > 50) {
                    if (diff > 0) {
                        acceptOrder();
                    } else {
                        rejectOrder();
                    }
                }
            });
        }

        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', () => {
            if (ordersData.length > 0) {
                setupSwipe();
                updateStats();
            }
        });
    </script>
</body>
</html>