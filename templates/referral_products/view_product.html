{% extends "referral_products/base.html" %}

{% block title %}{{ product.title }}{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-md-8">
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h3>{{ product.title }}</h3>
                </div>
                <div class="card-body">
                    <div class="mb-4">
                        <h5>–û–ø–∏—Å–∞–Ω–∏–µ</h5>
                        <p>{{ product.description }}</p>
                        {% if is_approved and referral_link %}
                        <div class="mt-4 p-3 border rounded bg-light">
                            <h5>–í–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞</h5>
                            <div class="input-group mb-3">
                                <input type="text" class="form-control" id="referralLink"
                                       value="{{ referral_link }}" readonly>
                                <button class="btn btn-outline-secondary" onclick="copyLink()">
                                    –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                                </button>
                            </div>
                            {% if qr_code %}
                            <div class="text-center mt-3">
                                <img src="data:image/png;base64,{{ qr_code }}"
                                     alt="QR-–∫–æ–¥ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏"
                                     class="img-fluid" style="max-width: 200px;">
                                <p class="mt-2">–û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞</p>
                            </div>
                            {% endif %}
                        </div>
                        <div class="mt-4 p-3 border rounded bg-light">
                            <h5>–í–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –¢–µ–ª–µ–≥—Ä–∞–º</h5>
                            <div class="input-group mb-3">
                                <input type="text" class="form-control" id="telegramLink"
                                       value="{{ telegram_link }}" readonly>
                                <button class="btn btn-outline-secondary" onclick="copyLink()">
                                    –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                                </button>
                            </div>
                            {% if qr_code %}
                            <div class="text-center mt-3">
                                <img src="data:image/png;base64,{{ telegram_qr }}"
                                     alt="QR-–∫–æ–¥ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏"
                                     class="img-fluid" style="max-width: 200px;">
                                <p class="mt-2">–û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞</p>
                            </div>
                            {% endif %}
                        </div>
                        {% endif %}
                    </div>

                    <div class="row mb-4">
                        <div class="col-md-6">
                            <h5>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–¥—É–∫—Ç–µ</h5>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item">
                                    <strong>–¶–µ–Ω–∞:</strong> {{ "%.2f"|format(product.price) }} ‚ÇΩ
                                </li>
                                <li class="list-group-item">
                                    <strong>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç:</strong> {{ product.referral_percent }}%
                                </li>
                                <li class="list-group-item">
                                    <strong>–°—Ç–∞—Ç—É—Å:</strong>
                                    <span class="badge bg-{{ 'success' if product.is_available else 'secondary' }}">
                                        {{ '–î–æ—Å—Ç—É–ø–µ–Ω' if product.is_available else '–ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω' }}
                                    </span>
                                </li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h5>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–∏–∑–Ω–µ—Å–µ</h5>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item">
                                    <strong>–ë–∏–∑–Ω–µ—Å:</strong> {{ business.title }}
                                </li>
                                <li class="list-group-item">
                                    <strong>ID –±–∏–∑–Ω–µ—Å–∞:</strong> {{ business.id }}
                                </li>
                            </ul>
                        </div>
                    </div>

                    <a href="{{ product.link2product }}"
                       class="btn btn-outline-primary me-2"
                       target="_blank">
                        –ü–µ—Ä–µ–π—Ç–∏ –∫ –ø—Ä–æ–¥—É–∫—Ç—É
                    </a>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</h5>
                </div>
                <div class="card-body">
                    <p>–í—ã –ø–æ–ª—É—á–∏—Ç–µ {{ product.referral_percent }}% —Å –∫–∞–∂–¥–æ–π –ø—Ä–æ–¥–∞–∂–∏ –ø–æ –≤–∞—à–µ–π —Å—Å—ã–ª–∫–µ</p>
                    {% if is_approved %}
                        {% if qr_code %}
                        <div class="alert alert-success">
                            ‚úÖ QR-–∫–æ–¥ —É–∂–µ —Å–æ–∑–¥–∞–Ω –¥–ª—è —ç—Ç–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞
                        </div>
                        <div class="text-center">
                            <img src="data:image/png;base64,{{ qr_code }}"
                                 alt="QR-–∫–æ–¥" class="img-fluid" style="max-width: 150px;">
                        </div>
                        {% else %}
                        <form method="POST"
                              action="{{ url_for('referral_products.generate_qr_code',
                                              referral_id=referral_id, product_id=product.id) }}">
                            <button type="submit" class="btn btn-success w-100">
                                üì∑ –°–æ–∑–¥–∞—Ç—å QR-–∫–æ–¥
                            </button>
                        </form>
                        {% endif %}
                    {% else %}
                        <div class="alert alert-warning">
                            ‚è≥ –í–∞—à–∞ –∑–∞—è–≤–∫–∞ –Ω–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ –æ–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
                        </div>
                    {% endif %}
                </div>
            </div>

            <div class="card shadow-sm mt-4">
                <div class="card-header bg-primary text-white">
                    <h5>–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h5>
                </div>
                <div class="card-body">
                    <a href="{{ url_for('referral_products.business_products', business_id=business.id, referral_id=referral_id) }}"
                       class="btn btn-outline-secondary w-100 mb-2">
                        –í—Å–µ –ø—Ä–æ–¥—É–∫—Ç—ã —ç—Ç–æ–≥–æ –±–∏–∑–Ω–µ—Å–∞
                    </a>
                    <a href="{{ url_for('referral_products.list_businesses', referral_id=referral_id) }}"
                       class="btn btn-outline-secondary w-100">
                        –í—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –±–∏–∑–Ω–µ—Å—ã
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function copyLink() {
    const copyText = document.getElementById("referralLink");
    copyText.select();
    copyText.setSelectionRange(0, 99999);
    document.execCommand("copy");
    alert("–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞: " + copyText.value);
}
</script>
{% endblock %}